
---
# CHIP-8 Emulator

## Описание проекта

Этот проект представляет собой эмулятор виртуальной машины **Chip-8**, реализованный на языке **C** с использованием библиотеки **SDL2** для отображения графики и обработки ввода. Эмулятор позволяет запускать программы и игры, написанные для Chip-8, на современных компьютерах, обеспечивая точное воспроизведение поведения оригинальной системы.

### Основные возможности

- **Эмуляция процессора**: Полная поддержка набора из 35 инструкций Chip-8.
- **Графический вывод**: Отображение монохромного дисплея 64x32 пикселя с масштабированием до 640x320 через SDL2.
- **Обработка ввода**: Эмуляция 16-клавишной клавиатуры Chip-8 с использованием клавиш SDL.
- **Таймеры**: Реализация таймера задержки (DT)  с частотой обновления 60 Гц.
- **Загрузка шрифтов**: Встроенные шрифты Chip-8 (0–F) для отрисовки символов.

Эмулятор разработан для простоты использования и поддержки классических игр Chip-8, таких как Pong, Space Invaders и других.

---

## Структура проекта

Проект состоит из следующих ключевых файлов:

- **`main.c`**: Точка входа программы. Инициализирует SDL, загружает ROM, обрабатывает события и запускает основной цикл эмуляции.
- **`chip8.h`**: Заголовочный файл с определением структуры `Chip_8`, содержащей состояние эмулятора (регистры, память, дисплей, стек и т.д.).
- **`chip8.c`**: Реализация функций инициализации эмулятора и загрузки шрифтов в память.
- **`instructions.h`**: Определение категорий и макросов для инструкций Chip-8.
- **`instructions.c`**: Логика выполнения инструкций, загрузки ROM, операций с регистрами и отрисовки спрайтов.
- **`utils.h`**: Макросы для битовых операций и отладочного логирования инструкций.
- **`constants.h`**: Константы эмулятора (размеры памяти, дисплея, стека и т.д.).
- **`CMakeLists.txt`**: Скрипт для сборки проекта с использованием CMake.

---

## Установка и запуск

### Требования

- Установленный компилятор C (например, `gcc`).
- Библиотека **SDL2** для графики и ввода.

### Установка SDL2

- **macOS**:
  ```bash
  brew install sdl2
  ```
- **Linux**:
  ```bash
  sudo apt-get install libsdl2-dev
  ```
- **Windows**: Скачайте SDL2 с официального сайта и настройте вручную (добавьте пути к заголовкам и библиотекам в ваш компилятор).

### Сборка проекта

1. Склонируйте репозиторий или скопируйте файлы проекта в локальную директорию.
2. Выполните команды для сборки с помощью CMake:
   ```bash
   cmake -B build
   cmake --build build
   ```

### Запуск эмулятора

Запустите эмулятор, указав путь к ROM-файлу в качестве аргумента:
```bash
./build/CHIP_8 /path/to/rom.ch8
```

Пример запуска тестового ROM:
```bash
./build/CHIP_8 /path/to/Chip8emulatorLogo.ch8
```

---

## Спецификация Chip-8

**Chip-8** — это интерпретируемый язык программирования, созданный в 1970-х годах для микрокомпьютеров, таких как COSMAC VIP. Он был разработан для упрощения создания игр и программ. Спецификация виртуальной машины Chip-8 включает следующие характеристики:

### Архитектура

- **Память**: 4 КБ (4096 байт) оперативной памяти (RAM).
- **Регистры**:
    - 16 8-битных регистров данных (`V0`–`VF`), где `VF` используется как флаг.
    - 16-битный регистр индекса (`I`) для работы с памятью.
    - 16-битный программный счетчик (`PC`), начинающийся с адреса `0x200`.
    - 8-битный указатель стека (`SP`).
    - Стек на 16 уровней для хранения адресов возврата.
- **Дисплей**: Монохромный, 64x32 пикселя (ширина x высота).
- **Ввод**: Клавиатура с 16 клавишами (0–9, A–F).
- **Таймеры**: Один 8-битный таймер:
    - Таймер задержки (DT).
      Частота 60 Гц.

### Набор инструкций

Chip-8 поддерживает 35 инструкций, каждая из которых представлена 2-байтовым опкодом. Вот несколько примеров:

- **`0x00E0` (CLS)**: Очистка экрана.
- **`0x00EE` (RET)**: Возврат из подпрограммы.
- **`0x1NNN` (JP NNN)**: Переход на адрес NNN.
- **`0x6XNN` (LD VX, NN)**: Загрузка значения NN в регистр VX.
- **`0xANNN` (LD I, NNN)**: Загрузка адреса NNN в регистр I.
- **`0xDXYN` (DRW VX, VY, N)**: Отрисовка спрайта высотой N строк из памяти по адресу I на координатах (VX, VY).

Полный список инструкций: [Cowgod's Chip-8 Technical Reference v1.0](http://devernay.free.fr/hacks/chip8/C8TECH10.HTM).

### Шрифты

Chip-8 включает встроенные шрифты для символов 0–F. Каждый символ представлен спрайтом высотой 5 байт. Эти шрифты загружаются в память эмулятора при инициализации.

---

## Как работает эмулятор

1. **Инициализация**:
    - Программа инициализирует структуру `Chip_8`, очищает память, регистры и дисплей.
    - Загружает шрифты Chip-8 в RAM с адреса `0x000`.

2. **Загрузка ROM**:
    - ROM-файл загружается в память, начиная с адреса `0x200`.
    - Если размер программы превышает доступную память, выводится ошибка.

3. **Основной цикл**:
    - Эмулятор выполняет инструкции из RAM, обновляет состояние процессора.
    - Обрабатывает ввод с клавиатуры через SDL.
    - Обновляет таймеры DT и ST с частотой 60 Гц.
    - Отрисовывает дисплей с использованием SDL2 (каждый пиксель масштабируется в 10 раз).

4. **Взаимодействие**:
    - Клавиши SDL сопоставляются с клавиатурой Chip-8 (например, `1-4`, `Q-R`, `A-F`, `Z-V` соответствуют `0x1-0xF`).

## Отладка

Эмулятор поддерживает отладочное логирование инструкций. Чтобы включить логирование:
1. Установите `#define CHIP8_DEBUG 1` в `utils.h`.
2. Пересоберите проект.

Логи будут выводиться в консоль в формате:
```
LD V0, 0x12; V0 = 18
DRW V0, V1, 5; Draw at (18,10) 5 bytes
```